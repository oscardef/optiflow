# ğŸ“ OptiFlow System Diagrams

## ğŸ”„ Complete Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Physical Hardware                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  ğŸ¢ Store Environment                                        â”‚
â”‚                                                              â”‚
â”‚     ğŸ“ Anchor 1 (0x0001)    ğŸ“ Anchor 2 (0x0002)            â”‚
â”‚         [RESPF]                 [RESPF]                      â”‚
â”‚           â”‚                       â”‚                          â”‚
â”‚           â”‚   UWB Radio Waves    â”‚                          â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                     â”‚                                        â”‚
â”‚                     â–¼                                        â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚            â”‚  ESP32-S3 + Tag  â”‚  ğŸš¶ Employee wearing         â”‚
â”‚            â”‚  (0x42 - Tag)    â”‚                              â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                     â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â”‚ WiFi (store/aisle1)
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   MacBook (172.20.10.3)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚       Mosquitto MQTT Broker                â”‚            â”‚
â”‚  â”‚         Port 1883                          â”‚            â”‚
â”‚  â”‚                                            â”‚            â”‚
â”‚  â”‚  Topics:                                   â”‚            â”‚
â”‚  â”‚  â€¢ store/aisle1  (ESP32 â†’ Backend)         â”‚            â”‚
â”‚  â”‚  â€¢ store/control (Backend â†’ ESP32)         â”‚            â”‚
â”‚  â”‚  â€¢ store/status  (ESP32 â†’ Backend)         â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                     â”‚                                        â”‚
â”‚                     â”‚ Subscribe                              â”‚
â”‚                     â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  ğŸ³ Docker Container: MQTT Bridge          â”‚            â”‚
â”‚  â”‚                                            â”‚            â”‚
â”‚  â”‚  â€¢ Subscribes to store/aisle1             â”‚            â”‚
â”‚  â”‚  â€¢ Forwards to FastAPI via HTTP POST      â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                     â”‚                                        â”‚
â”‚                     â”‚ HTTP POST /data                        â”‚
â”‚                     â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  ğŸ³ Docker Container: FastAPI Backend      â”‚            â”‚
â”‚  â”‚                                            â”‚            â”‚
â”‚  â”‚  Port 8000                                 â”‚            â”‚
â”‚  â”‚  â€¢ Validates JSON                          â”‚            â”‚
â”‚  â”‚  â€¢ Stores in PostgreSQL                    â”‚            â”‚
â”‚  â”‚  â€¢ Provides REST API                       â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                     â”‚                                        â”‚
â”‚                     â”‚ SQL INSERT                             â”‚
â”‚                     â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  ğŸ³ Docker Container: PostgreSQL            â”‚            â”‚
â”‚  â”‚                                            â”‚            â”‚
â”‚  â”‚  Port 5432                                 â”‚            â”‚
â”‚  â”‚  Database: optiflow                        â”‚            â”‚
â”‚  â”‚                                            â”‚            â”‚
â”‚  â”‚  Tables:                                   â”‚            â”‚
â”‚  â”‚  â€¢ detections (RFID data)                  â”‚            â”‚
â”‚  â”‚  â€¢ uwb_measurements (distance data)        â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                     â”‚                                        â”‚
â”‚                     â”‚ SQL SELECT                             â”‚
â”‚                     â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  ğŸ³ Docker Container: Next.js Frontend      â”‚            â”‚
â”‚  â”‚                                            â”‚            â”‚
â”‚  â”‚  Port 3000                                 â”‚            â”‚
â”‚  â”‚  â€¢ Polls /data/latest every 2s             â”‚            â”‚
â”‚  â”‚  â€¢ Displays live dashboard                 â”‚            â”‚
â”‚  â”‚  â€¢ Shows UWB measurements                  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                     â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â”‚ HTTP (localhost:3000)
                      â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   ğŸŒ Browser     â”‚
            â”‚   Dashboard UI   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ Message Flow Detail

### 1ï¸âƒ£ UWB Measurement

```
Anchor (0x0001)  â”€â”€â”€â”€â”€â”€â”€ UWB Signal â”€â”€â”€â”€â”€â”€â”€â”€â–¶  Tag (ESP32)
       â”‚                                          â”‚
       â”‚ "I'm at anchor 0x0001"                  â”‚
       â”‚                                          â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Distance = 62cm â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2ï¸âƒ£ ESP32 Processing

```
DWM3001CDK                      ESP32-S3
    â”‚                              â”‚
    â”‚ SESSION_INFO_NTF: {          â”‚
    â”‚   measurements=[             â”‚
    â”‚     [mac=0x0001,             â”‚
    â”‚      distance=62,            â”‚
    â”‚      status=SUCCESS]         â”‚
    â”‚   ]                          â”‚
    â”‚ }                            â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€ UART â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
    â”‚                              â”‚
    â”‚                              â”œâ”€ Parse session
    â”‚                              â”œâ”€ Build JSON
    â”‚                              â”œâ”€ Publish to MQTT
    â”‚                              â”‚
```

### 3ï¸âƒ£ JSON Packet

```json
{
  "timestamp": "2024-11-12T15:30:45",
  "detections": [],
  "uwb_measurements": [
    {
      "mac_address": "0x0001",
      "distance_cm": 62.0,
      "status": "SUCCESS"
    }
  ]
}
```

### 4ï¸âƒ£ MQTT â†’ Backend

```
ESP32 â”€â”€â”¬â”€â”€â–¶ Topic: store/aisle1
        â”‚    Payload: {...}
        â”‚
        â–¼
   Mosquitto â”€â”€â”¬â”€â”€â–¶ MQTT Bridge subscribes
               â”‚
               â–¼
          HTTP POST â”€â”€â–¶ FastAPI /data endpoint
```

### 5ï¸âƒ£ Database Storage

```sql
INSERT INTO uwb_measurements (
  timestamp,
  mac_address,
  distance_cm,
  status
) VALUES (
  '2024-11-12 15:30:45',
  '0x0001',
  62.0,
  'SUCCESS'
);
```

### 6ï¸âƒ£ Dashboard Display

```
Browser â”€â”€GETâ”€â”€â–¶ /data/latest?limit=50
         â”‚
         â—€â”€â”€JSONâ”€â”€â”€â”€â”˜
         â”‚
         â–¼
    Update Table:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ MAC Address â”‚ Distance â”‚ Status â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ 0x0001      â”‚ 62.0 cm  â”‚ âœ“      â”‚
    â”‚ 0x0001      â”‚ 63.5 cm  â”‚ âœ“      â”‚
    â”‚ 0x0001      â”‚ 61.2 cm  â”‚ âœ“      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ Network Topology

```
                    Internet
                       â”‚
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                             â”‚
   MacBook Hotspot              WiFi Network
   "Oscar"                      172.20.10.0/24
   172.20.10.3                         â”‚
        â”‚                              â”‚
        â”œâ”€â”€â”€ Mosquitto (1883)          â”‚
        â”œâ”€â”€â”€ Docker Bridge             â”‚
        â”‚    (backend, db, frontend)   â”‚
        â”‚                              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ WiFi
                       â”‚
                  ESP32-S3
                172.20.10.4
                       â”‚
                       â”‚ UART
                       â”‚
                  DWM3001CDK
                  (Tag Mode)
```

---

## ğŸ”§ Hardware Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ESP32-S3 Module             â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  WiFi/Bluetooth Radio        â”‚  â”‚
â”‚  â”‚  Dual-core Xtensa LX7        â”‚  â”‚
â”‚  â”‚  512KB SRAM, 8MB Flash       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚
â”‚  GPIO17 (TX) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  GPIO18 (RX) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  GND        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  3.3V       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ UART
                                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”
â”‚         DWM3001CDK Module       â”‚   â”‚
â”‚                                 â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  UWB Radio (6.5 GHz)     â”‚  â”‚   â”‚
â”‚  â”‚  DW3000 Chip             â”‚  â”‚   â”‚
â”‚  â”‚  FiRa UCI Protocol       â”‚  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚                                 â”‚   â”‚
â”‚  P0.08 (RX) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  P0.06 (TX) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  GND        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  VCC        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Port Mapping

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Host (MacBook)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Port 1883  â”€â”€â–¶ Mosquitto MQTT Broker                  â”‚
â”‚  Port 3000  â”€â”€â–¶ Docker: Next.js Frontend               â”‚
â”‚  Port 8000  â”€â”€â–¶ Docker: FastAPI Backend                â”‚
â”‚  Port 5432  â”€â”€â–¶ Docker: PostgreSQL Database            â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Data Lifecycle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                   â”‚
â”‚  1. Tag broadcasts UWB signal                   â”‚
â”‚     â†“                                            â”‚
â”‚  2. Anchors respond with timing info            â”‚
â”‚     â†“                                            â”‚
â”‚  3. Tag calculates distance                     â”‚
â”‚     â†“                                            â”‚
â”‚  4. DWM3001CDK sends SESSION_INFO_NTF           â”‚
â”‚     â†“                                            â”‚
â”‚  5. ESP32 parses UART data                      â”‚
â”‚     â†“                                            â”‚
â”‚  6. ESP32 builds JSON packet                    â”‚
â”‚     â†“                                            â”‚
â”‚  7. ESP32 publishes to MQTT                     â”‚
â”‚     â†“                                            â”‚
â”‚  8. MQTT Bridge receives message                â”‚
â”‚     â†“                                            â”‚
â”‚  9. Bridge forwards to FastAPI                  â”‚
â”‚     â†“                                            â”‚
â”‚  10. FastAPI validates schema                   â”‚
â”‚     â†“                                            â”‚
â”‚  11. FastAPI inserts into PostgreSQL            â”‚
â”‚     â†“                                            â”‚
â”‚  12. Frontend polls /data/latest                â”‚
â”‚     â†“                                            â”‚
â”‚  13. Browser displays in table                  â”‚
â”‚                                                   â”‚
â”‚  â±ï¸ Total Latency: ~500ms                       â”‚
â”‚                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Startup Sequence

```
1. Start Mosquitto
   â””â”€â–¶ Listening on 172.20.10.3:1883

2. Start Docker Compose
   â”œâ”€â–¶ PostgreSQL starts
   â”‚   â””â”€â–¶ Creates tables
   â”œâ”€â–¶ Backend starts
   â”‚   â””â”€â–¶ Connects to PostgreSQL
   â”œâ”€â–¶ MQTT Bridge starts
   â”‚   â””â”€â–¶ Connects to Mosquitto
   â””â”€â–¶ Frontend starts
       â””â”€â–¶ Connects to Backend API

3. Configure Anchors
   â”œâ”€â–¶ INITR (initialize as responder)
   â”œâ”€â–¶ RESPF (start ranging)
   â””â”€â–¶ SAVE (persist config)

4. Upload ESP32 Firmware
   â”œâ”€â–¶ Connects to WiFi
   â”œâ”€â–¶ Connects to MQTT
   â””â”€â–¶ Publishes ESP32_READY

5. Send START Signal
   â””â”€â–¶ ESP32 begins publishing UWB data

6. Open Dashboard
   â””â”€â–¶ See live measurements
```

---

## ğŸ” Security Model (Current)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          âš ï¸ Development Mode            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  MQTT: No authentication                â”‚
â”‚  API: No authentication                 â”‚
â”‚  Database: Default credentials          â”‚
â”‚  WiFi: Simple password                  â”‚
â”‚                                          â”‚
â”‚  âœ… OK for local development            â”‚
â”‚  âŒ NOT for production                  â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Future Production:
â€¢ MQTT TLS + username/password
â€¢ FastAPI JWT authentication
â€¢ PostgreSQL strong passwords
â€¢ WPA3 Enterprise WiFi
â€¢ VPN for remote access
```

This diagram file provides a comprehensive visual reference for understanding how all the pieces fit together!
